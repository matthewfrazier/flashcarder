<Window x:Class="Protomeme.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Protomeme"
        xmlns:dap="clr-namespace:DAP.Adorners;assembly=CroppingAdorner"
        Title="Instant Flash Cards" Height="594" Width="821"
        Loaded="Window_Loaded"
        >

	<DockPanel>
		<Menu DockPanel.Dock="Top">
			<MenuItem Header="_File">
				<MenuItem Header="_Open Session" Command="{Binding OpenSessionCommand}"/>
				<MenuItem Header="_Clear Session" Command="{Binding ClearImagesCommand}"/>
				<MenuItem Header="_Save Session" Command="{Binding SaveCommand}"/>
				<MenuItem Header="_Export Flash Cards" Command="{Binding ExportCommand}"/>

				<Separator/>
				<MenuItem Header="_Import Images" Command="{Binding LoadSourceImagesFromFilesCommand}"/>
			</MenuItem>
		</Menu>


		<Grid>
			<Grid.RowDefinitions>
				<RowDefinition Height="*" />
				<RowDefinition Height="350"/>
			</Grid.RowDefinitions>

			<DockPanel
                Grid.Row="0">
				<ListView 
                  x:Name="sourceImageListView"
                      ItemsSource="{Binding SourceImages}"
                SelectedItem="{Binding SelectedSourceImage}"
                >
					<ListView.ItemTemplate>
						<DataTemplate
                    >
							<StackPanel Orientation="Horizontal"
                                Margin="4,4,4,4"
                                >
								<Image 
                            Source="{Binding ImageUrl}" 
                            ToolTip="{Binding Title}"
                            MaxWidth="{Binding ActualWidth,RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ScrollContentPresenter}}}"
                                MaxHeight="60"
                            />
								
								<StackPanel Orientation="Vertical" HorizontalAlignment="Right"
											Width="120"
											Height="60"
											Background="Yellow">
									<Label Content="{Binding TaggedRegions.Count}"/>
								</StackPanel>
							</StackPanel>

						</DataTemplate>
					</ListView.ItemTemplate>
				</ListView>
			</DockPanel>

			<GridSplitter Grid.Row="0" VerticalAlignment="Bottom" HorizontalAlignment="Stretch" Height="5"/>

			<Grid
				Grid.Row="1"
				>
				<Grid.RowDefinitions>
					<RowDefinition Height="25"/>
					<RowDefinition Height="*"/>
					<RowDefinition Height="240"/>
				</Grid.RowDefinitions>
				<TextBlock Grid.Row="0"
						   Margin="4,4,4,4"
						   >
					
					(Original image is <TextBlock Text="{Binding ElementName=imageCropper,Path=Source.Width}"/>, <TextBlock Text="{Binding ElementName=imageCropper,Path=Source.Height}"/>. Cropped bounds 
					<TextBox Margin="2,2,2,2" Text="{Binding SelectedTaggedRegion.Region}"/>)
					
					Highlight the '<TextBlock Text="{Binding SelectedTaggedRegion.Tag}"/>' region.</TextBlock>

				<local:ImageCropper
					x:Name="imageCropper"
					Grid.Row="1"
					Source="{Binding SelectedSourceImage.ImageUrl}"
					CroppedImageBounds="{Binding SelectedTaggedRegion.Region,Mode=TwoWay}"
                    MaxWidth="{Binding ActualWidth,RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Grid}}}"
					/>

				<ListView
					Grid.Row="2"
                    ItemsSource="{Binding SelectedSourceImage.TaggedRegions}"
                    SelectedItem="{Binding SelectedTaggedRegion}"
					>
					<ListView.ItemsPanel>
						<ItemsPanelTemplate>
							<WrapPanel Width="{Binding (FrameworkElement.ActualWidth), RelativeSource={RelativeSource AncestorType=ScrollContentPresenter}}"
                                   ItemWidth="{Binding (ListView.View).ItemWidth, RelativeSource={RelativeSource AncestorType=ListView}}"
                                   MinWidth="{Binding ItemWidth, RelativeSource={RelativeSource Self}}"
                                   ItemHeight="{Binding (ListView.View).ItemHeight, RelativeSource={RelativeSource AncestorType=ListView}}" />
						</ItemsPanelTemplate>
					</ListView.ItemsPanel>
					<ListView.ItemTemplate>
						<DataTemplate>
								<DockPanel
                                HorizontalAlignment="Stretch"
                                Width="320"
                                MaxHeight="200">
								<TextBlock DockPanel.Dock="Top">
                                   <Label Content="{Binding Tag}"
                                           />
                                   <TextBox HorizontalAlignment="Right"
                                           Text="{Binding Region}"
                                           />
									</TextBlock>

								<Border BorderBrush="LightGray" BorderThickness="4" CornerRadius="4" Padding="5,5,5,5" Margin="4,4,4,4">
								<Image Source="{Binding Image}"
									   HorizontalAlignment="Stretch"
									   Width="320"
                                       Stretch="Uniform"/>
								</Border>

							</DockPanel>
							
						</DataTemplate>
					</ListView.ItemTemplate>
				</ListView>


			</Grid>

		</Grid>
	</DockPanel>

</Window>
